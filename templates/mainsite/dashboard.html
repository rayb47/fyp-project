{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PortuguesePro Learning Dashboard</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'dashboard.css' %}">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-black">
    <a class="navbar-brand" href="#">
      <img src="{% static 'portu_flag_pic.png' %}" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
      <span class="text-green">Portu</span><span class="text-red">Pro</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link active-tab" href="men_tester.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="gearth.html">Vocabulary</a>
      </li>
      <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="cultureDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Culture
          </a>
          <div class="dropdown-menu" aria-labelledby="cultureDropdown">
            <a class="dropdown-item" href="/architecture">Architecture</a>
            <a class="dropdown-item" href="page2.html">Festivals</a>
            <a class="dropdown-item" href="page3.html">Media</a>
            <!-- More dropdown items -->
          </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="moreDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          More
        </a>
        <div class="dropdown-menu" aria-labelledby="cultureDropdown">
          <a class="dropdown-item" href="page1.html">Diacritics</a>
          <a class="dropdown-item" href="page2.html">OS Language</a>
          <a class="dropdown-item" href="page3.html">Music & More</a>
          <!-- More dropdown items -->
        </div>
      <li class="nav-item">
        <a class="nav-link" href="gearth.html">Settings</a>
    </li>
        <!-- More nav items -->
      </ul>
      <span class="navbar-text">
        <a href="/signout" class="settings-link">Logout</a>
      </span>
    </div>
  </nav>

<div class="container mt-4">
  <div class="text-white">
    {% if user.is_authenticated %}
    <h1>{{greeting}} {{uname}}!</h1><br><br>
    {% endif %}
  </div>
  
  <div class="row">
    <div class="col-md-8">
      <div class="row">
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'conversation.jpg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">1 - Basic Conversation and Phrases</h5>
              <!-- <p class="card-text">Review your lessons and track your progress.</p> -->
              <a href="#" class="btn btn-primary">Lessons</a>
              <a href="/quiz" class="btn btn-primary">Quizzes</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'common_animals.jpg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">2 - Common Foods and Animal Names</h5>
              <!-- <p class="card-text">Review your lessons and track your progress.</p> -->
              <a href="#" class="btn btn-primary">Lessons</a>
              <a href="/quiz2" class="btn btn-primary">Quizzes</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'colors_numbers.jpeg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">3 - Colors, Numbers and Basic Objects</h5>
              <!-- <p class="card-text">Review your lessons and track your progress.</p> -->
              <a href="#" class="btn btn-primary">Lessons</a>
              <a href="/quiz3" class="btn btn-primary">Quizzes</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'outdoors.jpg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">4 - General Outdoors and Weather</h5>
              <!-- <p class="card-text">Review your lessons and track your progress.</p> -->
              <a href="#" class="btn btn-primary">Lessons</a>
              <a href="/quiz4" class="btn btn-primary">Quizzes</a>
            </div>
          </div>
        </div>
        
        <!-- Repeat for other units -->
      </div>
    </div>
    
    <div class="col-md-4">
      <h2 style="color: white">Weather Widget</h2>
      <div class="card mb-3 weather-widget">
        <div class="card-body">
            
            <h3 class="card-title city-title">{{city}}</h3>
            <div style="align-items: end; width:60px; float: right;">
              <img src="{{image}}" alt="Weather Icon" style="max-width: 100px;">
            </div>
            <h5 id="localTime" class="card-text">{{local_time}}</h5>
            <h5 id="liveTime">Random</h5>
            <h6 id="localTemp" class="card-text">{{temp_c}}</h6>
        </div>
      </div>
      <!-- Add other widgets like activity tracker and twitter feed -->
      <div id="calendar-container">
        <h2 style="color: white">Activity Tracker</h2>
        <table id="loginCalendar" class="calendar">
          <thead>
            <tr>
              <th colspan="7">
                  <button id="prevMonth">&#8592;</button>
                  <span id="monthYear"></span>
                  <button id="nextMonth">&#8594;</button>
              </th>
            </tr>
            <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
            </tr>
        </thead>
            <!-- Table Head for Weekdays will remain the same -->
            <tbody>
                <!-- Calendar days will be generated by JavaScript -->
            </tbody>
        </table>
    </div>
      <div class="twitter-container">
        <a class="twitter-timeline" data-theme="dark" href="https://twitter.com/theportugalnews?ref_src=twsrc%5Etfw">Tweets by theportugalnews</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
  function updateTime() {
    const now = new Date();
    // Specify the timeZone as Europe/Lisbon for Portugal
    const timeInPortugal = now.toLocaleTimeString('en-US', { timeZone: 'Europe/Lisbon', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });

    document.getElementById('liveTime').textContent = timeInPortugal;
}

// Update the time every second
setInterval(updateTime, 1000);

// Initialize
updateTime();
let currentDate = new Date();

document.addEventListener('DOMContentLoaded', function() {
    updateCalendar(currentDate);

    document.getElementById('prevMonth').addEventListener('click', () => {
        changeMonth(-1);
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
        changeMonth(1);
    });
});

function updateCalendar(date) {
    generateCalendar(date);
    document.getElementById('monthYear').textContent = `${date.toLocaleString('default', { month: 'long' })} ${date.getFullYear()}`;

    // Assume loginDates are fetched or defined here
    const loginDates = ['2024-02-20', '2024-02-21', '2023-09-18', '2024-03-03', '2024-03-04', '2024-03-01'];
    markLoginDates(loginDates, date);
}

function generateCalendar(date) {
    const monthDays = document.querySelector("#loginCalendar tbody");
    monthDays.innerHTML = "";

    let day = new Date(date.getFullYear(), date.getMonth(), 1);
    const today = new Date();
    
    // Adjusted to start the week on the correct day
    while (day.getDay() !== 0) {
        day.setDate(day.getDate() - 1);
    }

    // Generate days for the calendar
    for (let i = 0; i < (6*7); i++) { // 6 weeks coverage
        if (i % 7 === 0) {
            var week = document.createElement("tr");
            monthDays.appendChild(week);
        }
        let cell = document.createElement("td");
        if (day.getMonth() === date.getMonth()) {
            cell.textContent = day.getDate();
            if (day.toDateString() === today.toDateString()) {
                cell.classList.add("today");
            }
        }
        week.appendChild(cell);
        day.setDate(day.getDate() + 1);
    }
}

function changeMonth(change) {
    currentDate.setMonth(currentDate.getMonth() + change);
    updateCalendar(currentDate);
}

function markLoginDates(loginDates, date) {
    const month = date.getMonth();
    const year = date.getFullYear();
    document.querySelectorAll('#loginCalendar td').forEach(td => {
        const day = parseInt(td.textContent, 10);
        const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        if (loginDates.includes(dateString)) {
            td.classList.add('logged-in');
        }
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const weatherData = [
        { country: 'Porto', local_time: '06/03/2024', temp_c: '13.0°C' },
        { country: 'Madeira', local_time: '06/03/2024', temp_c: '16°C'}
        // Add more cities as needed
    ];

    let currentIndex = 0;

    function updateWeatherWidget() {
        const data = weatherData[currentIndex];
        document.querySelector('.city-title').innerHTML = `${data.country}`;
        document.querySelector('#localTime').innerHTML = `${data.local_time}`;
        document.querySelector('#localTemp').innerHTML = `${data.temp_c}`;
        // document.querySelector('img').src = data.image;

        currentIndex = (currentIndex + 1) % weatherData.length; // Loop back to the first city
    }

    setInterval(updateWeatherWidget, 5000); // Update every 5000 milliseconds (5 seconds)
});

document.addEventListener('DOMContentLoaded', () => {
    fetch('/weather_data')
        .then(response => response.json())
        .then(data => {
            // 'data' contains the weather data from your Django view
            console.log(data.data); // Access the 'data' key of the JSON response
            // Process and display this data as needed
        })
        .catch(error => console.error('Error fetching weather data:', error));
});
</script>
</body>
</html>
