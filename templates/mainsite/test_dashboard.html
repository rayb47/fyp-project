{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PortuguesePro Learning Dashboard</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'dashboard.css' %}">
<style></style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-black">
    <a class="navbar-brand" href="#">
      
      <img src="{% static 'Logo2.png' %}" alt="Logo" width="90" height="65" class="d-inline-block align-text-top">
      <h1><span class="text-green" style="margin-left: 10px;">Portu</span><span class="text-red">Pro</span></h1>
      
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto" id="navbarUL">
        <li class="nav-item active">
          <a class="nav-link active-tab nb-item" href="men_tester.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link nb-item" style="color: rgb(232, 255, 255);" href="/vocab">Vocabulary</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nb-item" style="color: rgb(232, 255, 255);" href="/analytics">Analytics</a>
    </li>
      <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle nb-item" style="color: rgb(232, 255, 255);"  href="#" id="cultureDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Culture
          </a>
          <div class="dropdown-menu" aria-labelledby="cultureDropdown">
            <a class="dropdown-item" href="/architecture">Architecture</a>
            <a class="dropdown-item" href="page2.html">Festivals</a>
            <a class="dropdown-item" href="page3.html">Media</a>
            <!-- More dropdown items -->
          </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle nb-item"  style="color: rgb(232, 255, 255);" href="#" id="moreDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          More
        </a>
        <div class="dropdown-menu" aria-labelledby="cultureDropdown">
          <a class="dropdown-item" href="page1.html">Diacritics</a>
          <a class="dropdown-item" href="page2.html">OS Language</a>
          <a class="dropdown-item" href="page3.html">Music & More</a>
          <!-- More dropdown items -->
        </div>
      <li class="nav-item">
        <a class="nav-link" style="color: rgb(232, 255, 255);" href="/settings">Settings</a>
    </li>
        <!-- More nav items -->
      </ul>
      <span class="navbar-text">
        <a href="/signout" class="settings-link nb-item">Logout</a>
      </span>
    </div>
  </nav>

<div class="container mt-4">
  <div class="text-white">
    {% if user.is_authenticated %}
    <h1>{{greeting}} {{user.username}}</h1><br>
    {% endif %}
  </div>
  
  <div class="row">
    <div class="col-md-8">
      <div class="row">
        
        {% for unit in units %}
        <div class="col-md-6 mb-3">
            <div class="card lesson-card">
              <img src="{{unit.description}}" class="img-responsive-img-top unit-img" alt="..." style="height:200px">
                <div class="card-body">
                    <h5 class="card-title">{{unit.id}} - {{unit.name}}</h5>
                    <!-- <p class="card-text">Review your lessons and track your progress.</p> -->
                    <a href="/lesson/{{unit.id}}" class="btn btn-primary">Lessons</a>
                    <!-- <a href="/quiz/1" class="btn btn-primary">Quizzes</a>  -->
                    <a href="#" class="btn btn-primary quiz-button" data-toggle="modal" data-target="#quizModal" data-unit="{{unit.id}}">Quizzes</a>
                </div>
            </div>
        </div>
        {% endfor %}
        
        
        
        <!-- <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'conversation.jpg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">1 - Basic Conversation and Phrases</h5>
              
              <a href="/lesson" class="btn btn-primary">Lessons</a>
              
              <a href="/quiz/1" class="btn btn-primary quiz-button" data-toggle="modal" data-target="#quizModal" data-unit="1">Quizzes</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'common_animals.jpg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">2 - Common Foods and Animal Names</h5>
              
              <a href="#" class="btn btn-primary">Lessons</a>
              <a href="/quiz2" class="btn btn-primary">Quizzes</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'colors_numbers.jpeg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">3 - Colors, Numbers and Basic Objects</h5>
             
              <a href="#" class="btn btn-primary">Lessons</a>
              
              <a href="/quiz3" class="btn btn-primary quiz-button" data-toggle="modal" data-target="#quizModal" data-unit="3">Quizzes</a>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card lesson-card">
            <img src="{% static 'outdoors.jpg' %}" class="card-img-top" alt="...">
            <div class="card-body">
              <h5 class="card-title">4 - General Outdoors and Weather</h5>
              
              <a href="#" class="btn btn-primary">Lessons</a>
              
              <a href="#" class="btn btn-primary" id="quizButton" data-toggle="modal" data-target="#quizModal">
                Quizzes
              </a>
            </div>
          </div>
        </div> -->

        <!-- Modal -->
        <div class="modal fade" id="quizModal" tabindex="-1" role="dialog" aria-labelledby="quizModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quizModalLabel">Quiz List</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="list-group">
                <!-- Quiz 1 -->
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                    Quiz 1: <strong>3 out of 10 questions answered</strong>
                    <div class="progress" style="height: 20px; margin-top: 10px; width: 80%;">
                        <div class="progress-bar" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">30%</div>
                    </div>
                    </div>
                    <a href="#" class="btn btn-primary">Access Quiz</a>
                </li>
                <!-- Quiz 2 -->
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                    Quiz 2: <strong>5 out of 10 questions answered</strong>
                    <div class="progress" style="height: 20px; margin-top: 10px; width: 80%;">
                        <div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                    </div>
                    </div>
                    <a href="#" class="btn btn-primary">Access Quiz</a>
                </li>
                <!-- Quiz 3 -->
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                    Quiz 3: <strong>7 out of 10 questions answered</strong>
                    <div class="progress" style="height: 20px; margin-top: 10px; width: 80%;">
                        <div class="progress-bar" role="progressbar" style="width: 70%;" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100">70%</div>
                    </div>
                    </div>
                    <a href="#" class="btn btn-primary">Access Quiz</a>
                </li>
                <!-- Quiz 4 -->
                <!-- <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                    Quiz 4: <strong>10 out of 10 questions answered</strong>
                    <div class="progress" style="height: 20px; margin-top: 10px; width: 80%;">
                        <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">100%</div>
                    </div>
                    </div>
                    <a href="#" class="btn btn-primary">Access Quiz</a>
                </li> -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!-- You can add additional buttons if needed -->
            </div>
            </div>
        </div>
        </div>
        
        <!-- Repeat for other units -->
      </div>
    </div>
    
    <div class="col-md-4 ">
      <h2 style="color: white">Weather Widget</h2>
      <div class="card mb-3 weather-widget">
        <div class="card-body">
            
            <h3 class="card-title city-title">{{city}}</h3>
            <div style="align-items: end; width:60px; float: right;">
              <img src="{{image}}" alt="Weather Icon" style="max-width: 100px;">
              <h6 id="localTemp" class="card-text">{{temp_c}}</h6>
            </div>
            <h5 id="localTime" class="card-text">{{local_time}}</h5>
            <h5 id="liveTime">Random</h5>
            <h6 id="localTemp" class="card-text">{{temp_c}}</h6>
        </div>
      </div>
    
      <!-- Add other widgets like activity tracker and twitter feed -->
      
      <h2 style="color: white">Activity Tracker</h2>
      <div class="card mb-3 calendar-widget">
      <!-- <div id="calendar-container"> -->
        
        <table id="loginCalendar" class="calendar">
          <thead>
            <tr>
              <th colspan="7">
                  <button id="prevMonth">&#8592;</button>
                  <span id="monthYear"></span>
                  <button id="nextMonth">&#8594;</button>
              </th>
            </tr>
            <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
            </tr>
        </thead>
            <!-- Table Head for Weekdays will remain the same -->
            <tbody>
                <!-- Calendar days will be generated by JavaScript -->
            </tbody>
        </table>
      <!-- </div> -->
    </div>
      <!-- <div class="twitter-container">
        <a class="twitter-timeline" data-theme="dark" href="https://twitter.com/theportugalnews?ref_src=twsrc%5Etfw">Tweets by theportugalnews</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
      </div> -->
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
  
  
  $(document).ready(function(){
    $('.quiz-button').click(function() {
        // var unitId = $(this).data('unit'); // Retrieve the data-unit attribute
        // console.log("Clicked on unit:"+unitId);
        // // Now update the href attribute for each Access Quiz button in the modal
        // $('#quizModal').find('.list-group-item').each(function(index) {
        //     $(this).find('a').attr('href', '/quiz/' + unitId + '/' + (index + 1));
        //     // or if you have an array with paths
        //     // $(this).find('a').attr('href', yourArrayWithPaths[index]);
        // });

    var unitId = $(this).data('unit');
         // Get the unit ID from the button's data attribute
        
        // Make an AJAX call to your Django view
        $.ajax({
            url: '/get_quiz_data',  // URL to your Django view that returns quiz data
            type: 'GET',
            data: {'unit_id': unitId},
            success: function(response) {
                // Assuming 'response' is an object with a 'quizzes' array
                // Clear the list
                var quizList = $('.modal-body .list-group').empty();
                
                // Iterate through quizzes and append to the list
                response.quizzes.forEach(function(quiz) {
                    var quizItem = `<li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            Quiz ${quiz.number}: <strong>${quiz.questions_answered} out of ${quiz.total_questions} questions answered</strong>
                            <div class="progress" style="height: 20px; margin-top: 10px; width: 80%;">
                                <div class="progress-bar" role="progressbar" style="width: ${quiz.progress_percent}%;" aria-valuenow="${quiz.progress_percent}" aria-valuemin="0" aria-valuemax="100">${quiz.progress_percent}%</div>
                            </div>
                        </div>
                        <a href="/quiz/${unitId}/${quiz.number}" class="btn btn-primary">Access Quiz</a>
                    </li>`;
                    quizList.append(quizItem);
                });
                
                // Show the modal after updating its content
                $('#quizModal').modal('show');
            },
            error: function(xhr, status, error) {
                console.error("Error fetching quiz data:", error);
            }
        });
    });
});
  
  function updateTime() {
    const now = new Date();
    // Specify the timeZone as Europe/Lisbon for Portugal
    const timeInPortugal = now.toLocaleTimeString('en-US', { timeZone: 'Europe/Lisbon', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });

    document.getElementById('liveTime').textContent = timeInPortugal;
}

// Update the time every second
setInterval(updateTime, 1000);

// Initialize
updateTime();
let currentDate = new Date();

document.addEventListener('DOMContentLoaded', function() {
    updateCalendar(currentDate);

    document.getElementById('prevMonth').addEventListener('click', () => {
        changeMonth(-1);
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
        changeMonth(1);
    });
});

function updateCalendar(date) {
    generateCalendar(date);
    document.getElementById('monthYear').textContent = `${date.toLocaleString('default', { month: 'long' })} ${date.getFullYear()}`;

    // Assume loginDates are fetched or defined here
    const loginDates = ['2024-02-20', '2024-02-21', '2023-09-18', '2024-03-03', '2024-03-04', '2024-03-01'];
    markLoginDates(loginDates, date);
}

function generateCalendar(date) {
    const monthDays = document.querySelector("#loginCalendar tbody");
    monthDays.innerHTML = "";

    let day = new Date(date.getFullYear(), date.getMonth(), 1);
    const today = new Date();
    
    // Adjusted to start the week on the correct day
    while (day.getDay() !== 0) {
        day.setDate(day.getDate() - 1);
    }

    // Generate days for the calendar
    for (let i = 0; i < (6*7); i++) { // 6 weeks coverage
        if (i % 7 === 0) {
            var week = document.createElement("tr");
            monthDays.appendChild(week);
        }
        let cell = document.createElement("td");
        if (day.getMonth() === date.getMonth()) {
            cell.textContent = day.getDate();
            if (day.toDateString() === today.toDateString()) {
                cell.classList.add("today");
            }
        }
        week.appendChild(cell);
        day.setDate(day.getDate() + 1);
    }
}

function changeMonth(change) {
    currentDate.setMonth(currentDate.getMonth() + change);
    updateCalendar(currentDate);
}

function markLoginDates(loginDates, date) {
    const month = date.getMonth();
    const year = date.getFullYear();
    document.querySelectorAll('#loginCalendar td').forEach(td => {
        const day = parseInt(td.textContent, 10);
        const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        if (loginDates.includes(dateString)) {
            td.classList.add('logged-in');
        }
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const weatherData = [
        { country: 'Porto', local_time: '06/03/2024', temp_c: '13.0°C' },
        { country: 'Madeira', local_time: '06/03/2024', temp_c: '16°C'}
        // Add more cities as needed
    ];

    let currentIndex = 0;

    function updateWeatherWidget() {
        const data = weatherData[currentIndex];
        document.querySelector('.city-title').innerHTML = `${data.country}`;
        document.querySelector('#localTime').innerHTML = `${data.local_time}`;
        document.querySelector('#localTemp').innerHTML = `${data.temp_c}`;
        // document.querySelector('img').src = data.image;

        currentIndex = (currentIndex + 1) % weatherData.length; // Loop back to the first city
    }

    setInterval(updateWeatherWidget, 5000); // Update every 5000 milliseconds (5 seconds)
});

document.addEventListener('DOMContentLoaded', () => {
    fetch('/weather_data')
        .then(response => response.json())
        .then(data => {
            // 'data' contains the weather data from your Django view
            console.log(data.data); // Access the 'data' key of the JSON response
            // Process and display this data as needed
        })
        .catch(error => console.error('Error fetching weather data:', error));
});
</script>
</body>
</html>
